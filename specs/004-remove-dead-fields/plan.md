# Implementation Plan: Remove Dead Fields from NodeContext

**Branch**: `004-remove-dead-fields` | **Date**: 2026-02-21 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/004-remove-dead-fields/spec.md`

## Summary

Remove the `variables: dict[str, Any]` field from `NodeContext`. The field is always constructed as `{}` by the engine and the one code path that reads it (`_framework_config` lookup in `LLMNode`) is structurally unreachable. Audit all other core data-model types — no other dead fields found. Bump version to `0.3.0`.

**Impact**: 6 files changed in `src/`; 0 test files changed; all 172 existing tests pass without modification.

## Technical Context

**Language/Version**: Python 3.11+
**Primary Dependencies**: Pydantic v2 (`BaseModel`, `Field`), pytest, pytest-asyncio
**Storage**: N/A (in-memory workflow execution)
**Testing**: pytest + pytest-asyncio; ruff for linting
**Target Platform**: Any Python 3.11+ environment
**Performance Goals**: N/A — dead field removal has no performance impact
**Constraints**: All 172 existing tests must pass with zero changes to test files
**Scale/Scope**: 6 source files changed; ~10 lines deleted total

## Constitution Check

### ✅ Principle I: Interface-First Design
- [X] Removing a field that was never part of the effective runtime contract
- [X] Implementation details hidden behind contracts — `NodeContext` will have a smaller, more accurate contract
- [X] Contract documented in `contracts/node_context_api.py`
- [X] This is a breaking change → version bumped to 0.3.0

### ✅ Principle II: Documented Public Interfaces
- [X] `NodeContext` docstring updated to remove the `variables` attribute entry
- [X] `LLMNode.execute()` docstring updated to remove "variables" reference
- [X] Type annotations remain complete after field removal

### ✅ Principle III: SOLID Principles
- [X] No change to SOLID compliance — this is a pure deletion
- [X] Single Responsibility: `NodeContext` more focused (only active fields)

### ✅ Principle IV: Observability (AI-Specific)
- [X] N/A — this change does not affect logging, metrics, or token tracking

### ✅ Principle V: Configurable But Convention First
- [X] N/A — no configuration changes

### ✅ Principle VI: Unit Tests (AI-Specific)
- [X] All 172 existing unit tests pass without modification
- [X] No test file uses `context.variables` directly
- [X] The contract in `contracts/node_context_api.py` serves as the acceptance test specification

### ✅ Principle VII: Integration Tests (AI-Specific)
- [X] All integration tests pass without modification
- [X] No integration test constructs `NodeContext(variables=...)` directly

### ✅ Principle VIII: Security (AI-Specific)
- [X] N/A — dead field removal has no security implications

### ✅ Principle IX: Use LTS Dependencies
- [X] No new dependencies introduced

### ✅ Principle X: Backward Compatibility (Framework-Critical)
- [X] Breaking change justified: package is pre-alpha (v0.x), field was never documented or tested
- [X] Version bumped: `0.2.0` → `0.3.0`
- [X] `CHANGELOG.md` updated with `## [0.3.0]` section listing removed field
- [X] `quickstart.md` provides migration guidance for the (unlikely) case of direct field access

### ✅ Principle XI: Extensibility & Plugin Architecture
- [X] N/A — plugin/middleware interfaces are unchanged

### ✅ Principle XII: Branch-Per-Task Development Workflow
- [X] Work is on dedicated feature branch `004-remove-dead-fields`
- [X] Unit and integration tests must pass before merging to main

## Project Structure

### Documentation (this feature)

```text
specs/004-remove-dead-fields/
├── plan.md              ← this file
├── research.md          ← field audit + decisions
├── data-model.md        ← NodeContext before/after
├── quickstart.md        ← migration guide
├── contracts/
│   └── node_context_api.py   ← acceptance test contract
└── tasks.md             ← generated by /speckit.tasks
```

### Source Code Changes

```text
src/generative_ai_workflow/
├── workflow.py          ← remove variables field from NodeContext (line 88, 97)
├── engine.py            ← remove variables={} from context construction (line 176)
├── node.py              ← simplify model fallback; update docstring (lines 65, 166-168)
└── __init__.py          ← bump __version__ to "0.3.0"

pyproject.toml           ← bump version to "0.3.0"
CHANGELOG.md             ← add ## [0.3.0] section
```

No changes to `tests/` — the existing 172 tests cover all modified code paths.

## Complexity Tracking

No constitution violations. This feature is a pure simplification.

## Phase 0: Research

**Status**: Complete — see `research.md`

No external research required. All decisions are based on static codebase analysis:

1. `variables` is provably dead (always `{}`, only read site unreachable) → **remove it**
2. `context.variables` fallback in `LLMNode` collapses to `"gpt-4o-mini"` → **simplify**
3. Audit of all other data-model types found no additional dead fields
4. Version bump: `0.2.0` → `0.3.0`

## Phase 1: Design & Contracts

**Status**: Complete

Artifacts generated:
- `data-model.md` — `NodeContext` before/after field sets; `LLMNode` internal simplification
- `contracts/node_context_api.py` — acceptance contract with field assertions and version check
- `quickstart.md` — migration guide for the removed field

### Precise Change Map

| File | Location | Change |
|------|----------|--------|
| `workflow.py` | Line 88 (docstring) | Remove `variables: Template substitution variables.` |
| `workflow.py` | Line 97 | Delete `variables: dict[str, Any] = Field(default_factory=dict)` |
| `engine.py` | Line 176 | Delete `variables={},` from `NodeContext(...)` constructor call |
| `node.py` | Line 65 (docstring) | Remove ", variables," from context description |
| `node.py` | Lines 165–168 | Replace 4-line model fallback with `or "gpt-4o-mini"` |
| `__init__.py` | `__version__` | `"0.2.0"` → `"0.3.0"` |
| `pyproject.toml` | `version` | `"0.2.0"` → `"0.3.0"` |
| `CHANGELOG.md` | Top | Add `## [0.3.0] - 2026-02-21` with `### Removed` subsection |
